<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Computer Graphics Assignment</title>
        <style>
            body {
                background-color: #fff;
            }
            #container {
                position: relative;
                width: 100%;
                height: 100%;
            }
            #canvasContainer {
                position: absolute;
                right: 2%;
                top: 6%;
            }
            #settingsContainer {
                position: absolute;
                left: 1%;
                top: 1%;
                width: 30%;
                min-width: 200px;
            }
            #settingsContainer p {
                margin: 0;
            }
            #settingsContainer select,
            #settingsContainer input[type="range"] {
                width: 70%;
                vertical-align: middle;
            }
            #settingsContainer table {
                width: 100%;
            }
            #settingsContainer table td {
                white-space: nowrap;
            }
            #movieModeContainer {
                display: none;
            }
        </style>
        <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
        <link rel="stylesheet" href="styles.css">
        <script type="text/javascript" src="./js/glMatrix-0.9.5.min.js"></script>
        <script type="text/javascript" src="./js/webgl-utils.js"></script>
<!-- 
    TODO HERE: 
    modify fragment shader or write another one
    to implement flat, gouraud and phong shading
 -->
<script id="fragmentShader" type="fragment">
    #extension GL_OES_standard_derivatives : enable
    precision highp float;

    vec3 lightColor = vec3(1.0,0.8,0.5);

    uniform vec3 lightLoc;
    uniform vec3 lightLoc2;
    uniform vec3 lightLoc3;
    uniform int shadingMethod;
    uniform float Ka; // Ambient coefficient

    varying vec4 fragcolor;
    varying vec3 mvVertex;
    varying vec3 vNormal;
    varying vec3 vPosition;
    varying vec3 frontColor_phong;

    void main(void) {
        if (shadingMethod==1){
            /* ambient */
            vec3 ambient_color = Ka * vec3(fragcolor);

            //diffuse conbine
            //vec3 dx = dFdx(mvVertex);
            //vec3 dy = dFdy(mvVertex);
            vec3 normal = normalize(cross(dFdx(mvVertex), dFdy(mvVertex))); 

            // specular  refactor
            vec3 lightDir = normalize(lightLoc - mvVertex);
            vec3 lightDir2 = normalize(lightLoc2 - mvVertex);
            vec3 lightDir3 = normalize(lightLoc3 - mvVertex);
            float diffuseCos = max(dot(normal, lightDir), 0.0);
            float diffuseCos2 = max(dot(normal, lightDir2), 0.0);
            float diffuseCos3 = max(dot(normal, lightDir3), 0.0);
            
            
            vec3 diffuseColorAll = lightColor * 0.5 * vec3(fragcolor) * (diffuseCos + diffuseCos2 + diffuseCos3); //diffuseColor 

            vec3 CamDir = normalize(-mvVertex);

            float specularCos = pow(max(dot(reflect(-lightDir, normal), CamDir), 0.0), 1.5);
            float specularCos2 = pow(max(dot(reflect(-lightDir2, normal), CamDir), 0.0), 1.5);
            float specularCos3 = pow(max(dot(reflect(-lightDir3, normal), CamDir), 0.0), 1.5);
            
            vec3 specularColorAll= 0.5 * lightColor * (specularCos + specularCos2 + specularCos3);

            vec3 color = ambient_color + diffuseColorAll + specularColorAll ;
            gl_FragColor = vec4(color, 1.0);

        }else if (shadingMethod==2){
            gl_FragColor = fragcolor;

        }else{
            
            vec3 N = normalize(vNormal);

            vec3 L = normalize(lightLoc - vPosition);
            vec3 L2 = normalize(lightLoc2 - vPosition);
            vec3 L3 = normalize(lightLoc3 - vPosition);
            
            vec3 V = -normalize(vPosition);
            
            vec3 H = normalize(L + V);
            vec3 H2 = normalize(L2 + V);
            vec3 H3 = normalize(L3 + V);

            float ka = Ka;
            float kd = 0.6;
            float ks = 0.3;

            vec3 ambient = ka * lightColor;

            vec3 diffuseAll = (
                max(dot(N, L3), 0.0) + 
                max(dot(N, L3), 0.0) + 
                max(dot(N, L3), 0.0) ) * kd * lightColor ;
            
            vec3 specularAll = (
                pow(max(dot(N, H ), 0.0), 32.0) +
                pow(max(dot(N, H2), 0.0), 32.0) + 
                pow(max(dot(N, H3), 0.0), 32.0) ) * ks * lightColor;

            vec3 phong = ambient + diffuseAll + specularAll ;
            phong *= frontColor_phong.rgb;

            gl_FragColor = vec4(phong, 1.0);
        }
    }
</script>

<script id="vertexShader" type="vertex">

    attribute vec3 aVertexPosition;
    attribute vec3 aVertexNormal;
    attribute vec3 aFrontColor;

    //attribute vec3 aVertexCentralPosition;

    struct Light
    {
        float swich;
        vec3 position;
        vec3 ambient;
        vec3 diffuse;
        vec3 specular;
    };

    struct Material
    {
        float shininess;
    };

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    uniform vec3 lightLoc;
    uniform vec3 lightLoc2;
    uniform vec3 lightLoc3;

    varying vec4 fragcolor;

    varying vec3 mvVertex;
    varying vec3 vNormal;
    varying vec3 vPosition;

    uniform int shadingMethod_vertex;
    varying vec3 frontColor_phong;

    uniform float Ka; // Ambient coefficient

    void main(void) {
        if (shadingMethod_vertex==1){
            
            //mvVertex = (uMVMatrix * vec4(aVertexPosition,1.0)).xyz;
            
            gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
            fragcolor = vec4(aFrontColor.rgb, 1.0); 
            
        }else if (shadingMethod_vertex==2){
            
            vec3 lightColor = vec3(1.0,0.8,0.5);

            // Transform VertexPosition and VertexNormal to world coordinate system
            vec3 mvVertex = (uMVMatrix * vec4(aVertexPosition, 1.0)).xyz;
            
            //conbine
            //mat3 normalMVMatrix = mat3(uMVMatrix);
            //vec3 mvNormal = normalMVMatrix * aVertexNormal;
            vec3 mvNormal = mat3(uMVMatrix) * aVertexNormal;
            
            // V, N, L, H
            vec3 V = -normalize(mvVertex);
            vec3 N = normalize(mvNormal);
            vec3 L = normalize(lightLoc - mvVertex);
            vec3 L2 = normalize(lightLoc2 - mvVertex);
            vec3 L3 = normalize(lightLoc3 - mvVertex);
            vec3 H = normalize(L + V);
            vec3 H2 = normalize(L2 + V);
            vec3 H3 = normalize(L3 + V);

            // Ambient, diffuse and specular coef.
            float ka = Ka;
            float kd = 0.6;
            float ks = 0.3;

            vec3 gouraud = vec3(0.3,0.8,1.0);
            
            //conbine
            vec3 ambient = ka * lightColor;
            //vec3 diffuse = max(dot(N, L), 0.0) * kd * lightColor;
            //vec3 diffuse2 = max(dot(N, L2), 0.0) * kd * lightColor;
            //vec3 diffuse3 = max(dot(N, L3), 0.0) * kd * lightColor;
            vec3 diffuseALL = (
                max(dot(N, L), 0.0) +
                max(dot(N, L2), 0.0) +
                max(dot(N, L3), 0.0) ) * kd * lightColor;

            //vec3 specular = pow(max(dot(N, H), 0.0), 32.0) * ks * lightColor;
            //vec3 specular2 = pow(max(dot(N, H2), 0.0), 32.0) * ks * lightColor;
            //vec3 specular3 = pow(max(dot(N, H3), 0.0), 32.0) * ks * lightColor;
            vec3 specularAll = (
                pow(max(dot(N, H), 0.0), 32.0) +
                pow(max(dot(N, H2), 0.0), 32.0) +
                pow(max(dot(N, H3), 0.0), 32.0) ) ks * lightColor;
            gouraud = ambient + diffuseALL + specularAll;

            gouraud *= aFrontColor.rgb;
            fragcolor = vec4(gouraud, 1.0);
            gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);

        }else{

            // Transform the vertex position to world coordinates

            //vPosition = (uMVMatrix * vec4(aVertexPosition, 1.0)).xyz;
            
            // Transform the normal to world coordinates

            mat3 normalMatrix = mat3(uMVMatrix);
            vNormal = normalMatrix * aVertexNormal;
            frontColor_phong = aFrontColor;

            // Set the position of the current vertex
            gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        }
    }
</script>

<script type="text/javascript" src="./js/mainfun.js"></script>
</head>
<body style="background-color: #FFF;" onload="webGLStart();">
    <div style="position: relative; width: 100%; height: 100%;">
        <div style="position: absolute; right: 2%; top:6%;">
            <canvas id="ICG-canvas" style="border: none; background-color: #114514;" width="840" height="590"></canvas>
        </div>
        <div style="position: absolute; left: 1%; top: 1%; max-width: 30%; min-width: 30%;">
            <p>
                <label for="shading">
                    <span>Shading types : </span>
                    <tr>
                        <span id="shadingMethodLabel">Flat Shading</span>
                </label>
            </p>
            <select id="shadingMethod" onchange="updateShadingMethod()">
            <option value="1">Flat</option>
            <option value="2">Gouraud</option>
            <option value="3">Phong</option>
            </select>
            <br>
            <div>&nbsp;</div>
            <table>
            <tr>
            <td>
            Spining(Rotating) Speed : <input type="range" id="rotationSpeedFactor" min="0.0" max="5"
                step="0.01" value="0.03" oninput="updateRotationSpeed()">
            </td>
            </tr>
            </table>
            <br>
            <span>Targact Objects</span>
            <table>
            <select id="objectSelect" onchange="display_screen(this.value)">
            <option value="teapot">Teapot</option>
            <option value="Plant">Plant</option>
            <option value="Csie">Csie</option>
            </select>
            <tr id="teapotTrans">
            <td style="white-space: nowrap;">Trans:</td>
            <td>X: <input id="transX" type="range" autocomplete="off" value="0." max="50." min="-50."
                oninput="update_trans('teapot')"></td>
            <td>Y: <input id="transY" type="range" autocomplete="off" value="0." max="50." min="-50."
                oninput="update_trans('teapot')"></td>
            <td>Z: <input id="transZ" type="range" autocomplete="off" value="-50." max="0." min="-120."
                oninput="update_trans('teapot')"></td>
            </tr>
            <tr id="PlantTrans" style="display:none;">
            <td style="white-space: nowrap;">Trans:</td>
            <td>X: <input id="transX2" type="range" autocomplete="off" value="0." max="50." min="-50."
                oninput="update_trans('Plant')"></td>
            <td>Y: <input id="transY2" type="range" autocomplete="off" value="0." max="50." min="-50."
                oninput="update_trans('Plant')"></td>
            <td>Z: <input id="transZ2" type="range" autocomplete="off" value="-50." max="0." min="-120."
                oninput="update_trans('Plant')"></td>
            </tr>
            <tr id="CsieTrans" style="display:none;">
            <td style="white-space: nowrap;">Trans:</td>
            <td>X: <input id="transX3" type="range" autocomplete="off" value="0." max="50." min="-50."
                oninput="update_trans('Csie')"></td>
            <td>Y: <input id="transY3" type="range" autocomplete="off" value="0." max="50." min="-50."
                oninput="update_trans('Csie')"></td>
            <td>Z: <input id="transZ3" type="range" autocomplete="off" value="-50." max="0." min="-120."
                oninput="update_trans('Csie')"></td>
            </tr>
            <script>
                function display_screen(selectedObject) {
                    document.getElementById('teapotTrans').style.display = 'none';
                    document.getElementById('CsieTrans').style.display = 'none';
                    document.getElementById('PlantTrans').style.display = 'none';
                    document.getElementById('teapotRotate').style.display = 'none';
                    document.getElementById('CsieRotate').style.display = 'none';
                    document.getElementById('PlantRotate').style.display = 'none';
                    document.getElementById('teapotShear').style.display = 'none';
                    document.getElementById('CsieShear').style.display = 'none';
                    document.getElementById('PlantShear').style.display = 'none';
                    document.getElementById('scaleT').style.display = 'none';
                    document.getElementById('scaleK').style.display = 'none';
                    document.getElementById('scaleF').style.display = 'none';
                    document.getElementById(selectedObject + 'Trans').style.display = 'table-row';
                    document.getElementById(selectedObject + 'Rotate').style.display = 'table-row';
                    document.getElementById(selectedObject + 'Shear').style.display = 'table-row';
                    document.getElementById('scale' + selectedObject[0].toUpperCase()).style.display = 'table-row';
                
                }
            </script>
            <tr id="teapotRotate">
            <td style="white-space: nowrap;">Rotate:</td>
            <td>X: <input id="rotateX" type="range" autocomplete="off" value="0." max="180." min="-180."
                oninput="update_rotate('teapot')"></td>
            <td>Y: <input id="rotateY" type="range" autocomplete="off" value="0." max="180." min="-180."
                oninput="update_rotate('teapot')"></td>
            <td>Z: <input id="rotateZ" type="range" autocomplete="off" value="0." max="180." min="-180."
                oninput="update_rotate('teapot')"></td>
            </tr>
            <tr id="PlantRotate" style="display: none;">
            <td style="white-space: nowrap;">Rotate:</td>
            <td>X: <input id="rotateX2" type="range" autocomplete="off" value="0." max="180." min="-180."
                oninput="update_rotate('Plant')"></td>
            <td>Y: <input id="rotateY2" type="range" autocomplete="off" value="0." max="180." min="-180."
                oninput="update_rotate('Plant')"></td>
            <td>Z: <input id="rotateZ2" type="range" autocomplete="off" value="0." max="180." min="-180."
                oninput="update_rotate('Plant')"></td>
            </tr>
            <tr id="CsieRotate" style="display: none;">
            <td style="white-space: nowrap;">Rotate:</td>
            <td>X: <input id="rotateX3" type="range" autocomplete="off" value="0." max="180." min="-180."
                oninput="update_rotate('Csie')"></td>
            <td>Y: <input id="rotateY3" type="range" autocomplete="off" value="0." max="180." min="-180."
                oninput="update_rotate('Csie')"></td>
            <td>Z: <input id="rotateZ3" type="range" autocomplete="off" value="0." max="180." min="-180."
                oninput="update_rotate('Csie')"></td>
            </tr>
            <tr id="teapotShear">
            <td style="white-space: nowrap;">Shear:</td>
            <td>X: <input id="shearX" type="range" autocomplete="off" value="0.0" max="10" min="-10"
                step="0.1" oninput="update_shear('teapot')"></td>
            <td>Y: <input id="shearY" type="range" autocomplete="off" value="0.0" max="10" min="-10"
                step="0.1" oninput="update_shear('teapot')"></td>
            <td>Z: <input id="shearZ" type="range" autocomplete="off" value="0.0" max="10" min="-10"
                step="0.1" oninput="update_shear('teapot')"></td>
            </tr>
            <tr id="PlantShear" style="display: none;">
            <td style="white-space: nowrap;">Shear:</td>
            <td>X: <input id="shearX1" type="range" autocomplete="off" value="0.0" max="10" min="-10"
                step="0.1" oninput="update_shear('Plant')"></td>
            <td>Y: <input id="shearY1" type="range" autocomplete="off" value="0.0" max="10" min="-10"
                step="0.1" oninput="update_shear('Plant')"></td>
            <td>Z: <input id="shearZ1" type="range" autocomplete="off" value="0.0" max="10" min="-10"
                step="0.1" oninput="update_shear('Plant')"></td>
            </tr>
            <tr id="CsieShear" style="display: none;">
            <td style="white-space: nowrap;">Shear:</td>
            <td>X: <input id="shearX2" type="range" autocomplete="off" value="0.0" max="10" min="-10"
                step="0.1" oninput="update_shear('Csie')"></td>
            <td>Y: <input id="shearY2" type="range" autocomplete="off" value="0.0" max="10" min="-10"
                step="0.1" oninput="update_shear('Csie')"></td>
            <td>Z: <input id="shearZ2" type="range" autocomplete="off" value="0.0" max="10" min="-10"
                step="0.1" oninput="update_shear('Csie')"></td>
            </tr>
            <td>Axis:</td>
            <td colspan="3">
            <select id="shearMode" onchange="update_shear()">
            <option value="0">X</option>
            <option value="1">Y</option>
            <option value="2">Z</option>
            </select>
            </td>
            </tr>
            <tr id="scaleT">
            <td style="white-space: nowrap;">Scale:</td>
            <td>X: <input id="scaleX_teapot" type="range" autocomplete="off" value="1.0" max="2.0" min="0.1"
                step="0.1" oninput="update_scale('teapot')"></td>
            <td>Y: <input id="scaleY_teapot" type="range" autocomplete="off" value="1.0" max="2.0" min="0.1"
                step="0.1" oninput="update_scale('teapot')"></td>
            <td>Z: <input id="scaleZ_teapot" type="range" autocomplete="off" value="1.0" max="2.0" min="0.1"
                step="0.1" oninput="update_scale('teapot')"></td>
            </tr>
            <tr id="scaleF" style="display: none;">
            <td style="white-space: nowrap;">Scale:</td>
            <td>X: <input id="scaleX_Csie" type="range" autocomplete="off" value="1.0" max="2.0" min="0.1"
                step="0.1" oninput="update_scale('Csie')"></td>
            <td>Y: <input id="scaleY_Csie" type="range" autocomplete="off" value="1.0" max="2.0" min="0.1"
                step="0.1" oninput="update_scale('Csie')"></td>
            <td>Z: <input id="scaleZ_Csie" type="range" autocomplete="off" value="1.0" max="2.0" min="0.1"
                step="0.1" oninput="update_scale('Csie')"></td>
            </tr>
            <tr id="scaleK" style="display: none;">
            <td style="white-space: nowrap;">Scale:</td>
            <td>X: <input id="scaleX_Plant" type="range" autocomplete="off" value="1.0" max="2.0" min="0.1"
                step="0.1" oninput="update_scale('Plant')"></td>
            <td>Y: <input id="scaleY_Plant" type="range" autocomplete="off" value="1.0" max="2.0" min="0.1"
                step="0.1" oninput="update_scale('Plant')"></td>
            <td>Z: <input id="scaleZ_Plant" type="range" autocomplete="off" value="1.0" max="2.0" min="0.1"
                step="0.1" oninput="update_scale('Plant')"></td>
            </tr>
            <tr style="display: none;">
            <td style="white-space: nowrap;">Epic Mode:</td>
            <td><label class="switch">
            <input id="movieMode" type="checkbox" onclick="toggleMovieMode()">
            <span class="slider round"></span>
            </label></td>
            <td colspan="4">
            <p style="white-space: nowrap;">*Experimental, disables shear and scale above.</p>
            </td>
            </tr>
            <br><br><br>
            <!-- <span>Ambient Light</span> -->
            <table>
            <tr>
            <td>Ka: <input style="max-width: 70%; vertical-align: middle;" id="am_ka" type="range"
                autocomplete="off" value="0.1" max="1." min="0." step="0.05"
                oninput="update_ambient_light()"></td>
            </tr>
            </table>
            <br>
            <span>illumination 1</span>
            <table>
            <tr>
            <td>X: <input style="max-width: 70%; vertical-align: middle;" id="llocX" type="range"
                autocomplete="off" value="30." max="1140." min="-1140." oninput="update_light_location()">
            </td>
            <td>Y: <input style="max-width: 70%; vertical-align: middle;" id="llocY" type="range"
                autocomplete="off" value="20." max="1140." min="-1140." oninput="update_light_location()">
            </td>
            <td>Z: <input style="max-width: 70%; vertical-align: middle;" id="llocZ" type="range"
                autocomplete="off" value="0." max="1140." min="-1140." oninput="update_light_location()">
            </td>
            </tr>
            </table>
            <span>illumination 2</span>
            <table>
            <tr>
            <td>X: <input style="max-width: 70%; vertical-align: middle;" id="llocX2" type="range"
                autocomplete="off" value="50." max="1140." min="-1140." oninput="update_light_location2()">
            </td>
            <td>Y: <input style="max-width: 70%; vertical-align: middle;" id="llocY2" type="range"
                autocomplete="off" value="50." max="1140." min="-1140." oninput="update_light_location2()">
            </td>
            <td>Z: <input style="max-width: 70%; vertical-align: middle;" id="llocZ2" type="range"
                autocomplete="off" value="0." max="1140." min="-1140." oninput="update_light_location2()">
            </td>
            </tr>
            </table>
            <span>illumination 3</span>
            <table>
            <tr>
            <td>X: <input style="max-width: 70%; vertical-align: middle;" id="llocX3" type="range"
                autocomplete="off" value="0." max="1140." min="-1140." oninput="update_light_location3()">
            </td>
            <td>Y: <input style="max-width: 70%; vertical-align: middle;" id="llocY3" type="range"
                autocomplete="off" value="0." max="1140." min="-1140." oninput="update_light_location3()">
            </td>
            <td>Z: <input style="max-width: 70%; vertical-align: middle;" id="llocZ3" type="range"
                autocomplete="off" value="0." max="1140." min="-1140." oninput="update_light_location3()">
            </td>
            </tr>
            </table>
            <br>
            <tr>
            <br>
            </table>
        </div>
    </div>
</body>
</html>